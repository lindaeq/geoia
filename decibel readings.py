import folium
from folium.plugins import HeatMap

# Coordinates for the heatmap (location data)
coordinates = [
    (-75.68598998, 45.3993471),
    (-75.68504322, 45.39983201),
    (-75.68418909, 45.40019666),
    (-75.6851941, 45.3978694),
    (-75.70777173, 45.37671213),
    (-75.6849731, 45.3990165),
    (-75.68469976, 45.399926),
    (-75.68657874, 45.41529579),
    (-75.69000014, 45.41743525),
    (-75.6887961, 45.4160652),
    (-75.68987252, 45.41737817),
    (-75.68779272, 45.41527702),
    (-75.68901959, 45.41646855),
    (-75.69073209, 45.41811772),
    (-75.69036878, 45.41771403),
    (-75.68818156, 45.41586523),
    (-75.6884273, 45.4157928),
    (-75.69115298, 45.41886274),
    (-75.69008699, 45.4174835),
    (-75.69141602, 45.41905811),
    (-75.69523811, 45.42822252),
    (-75.69534506, 45.42808166),
    (-75.69502512, 45.42807899),
    (-75.6926678, 45.4273578),
    (-75.69419718, 45.42850909),
    (-75.69431242, 45.42848439),
    (-75.69365306, 45.42868656),
    (-75.6926905, 45.42810224),
    (-75.69431975, 45.42843863),
    (-75.6944276, 45.428548),
    (-75.69226823, 45.42767069),
    (-75.69297033, 45.42907781),
    (-75.69108116, 45.42654176)
]

# Decibel data with coordinates
decibel_data = [
    (64.8, -75.68607551, 45.39950376),
    (61.4, -75.685485, 45.399294),
    (58.85, -75.685485, 45.399294),
    (61.775, -75.6840382, 45.3998534),
    (63.3, -75.68586963, 45.3995553),
    (58.975, -75.685485, 45.399294),
    (63.675, -75.68327214, 45.40149973),
    (61.825, -75.68573375, 45.39956858),
    (63.075, -75.6842269, 45.3996538),
    (61.275, -75.684409, 45.399757),
    (61.675, -75.685485, 45.399294),
    (63.975, -75.68507748, 45.3998149),
    (61.325, -75.6846017, 45.3988245),
    (56.375, -75.684089, 45.400485),
    (59.925, -75.68401096, 45.4001816),
    (57.65, -75.684593, 45.399135),
    (65.275, -75.6860014, 45.3989872),
    (63.325, -75.68499931, 45.39930391),
    (62.45, -75.6858507, 45.3983931),
    (69.1, -75.6897981, 45.41712066),
    (71.175, -75.68989514, 45.41726258),
    (65.825, -75.69020236, 45.41761246),
    (56.475, -75.686779, 45.4137983),
    (64.75, -75.68983235, 45.41729423),
    (62.1, -75.68714512, 45.41407603),
    (66.175, -75.69044362, 45.41787066),
    (61.85, -75.6871281, 45.4141369),
    (63.3, -75.69001589, 45.41746923),
    (64.575, -75.690993, 45.41825),
    (62.325, -75.6875865, 45.4146843),
    (65.5, -75.69084874, 45.41846022),
    (62.225, -75.688005, 45.4149398),
    (62.85, -75.69119667, 45.41878036),
    (63.075, -75.6880564, 45.4153291),
    (60.575, -75.69083059, 45.4187056),
    (66.8, -75.69140446, 45.41902378),
    (64.625, -75.68837311, 45.41543615),
    (61.15, -75.6888315, 45.4160066),
    (62.2, -75.69542322, 45.4281672),
    (64.925, -75.69190474, 45.42958545),
    (68.3, -75.6949924, 45.4275351),
    (62.075, -75.694583, 45.427704),
    (58.95, -75.6950455, 45.42824933),
    (63.35, -75.69214611, 45.4294945),
    (60.075, -75.69405245, 45.42785807),
    (55.8, -75.69409885, 45.42751088),
    (58.325, -75.69436684, 45.42842709),
    (64.125, -75.69305243, 45.4290916),
    (58.525, -75.693878, 45.428038),
    (57.85, -75.69274151, 45.4287771),
    (61.4, -75.6938421, 45.42878665),
    (61.05, -75.6939274, 45.4279965),
    (64.05, -75.6933885, 45.4281619),
    (63.95, -75.69405959, 45.42864118),
    (60.775, -75.6930399, 45.4279341),
    (58.975, -75.6924659, 45.427294),
    (64.225, -75.68087067, 45.39901306),
    (63.4, -75.687939, 45.416862),
    (61.8, -75.691521, 45.42851877),
    (60.575, -75.692049, 45.42737)
]

map_heatmap = folium.Map(location=[sum([lat for lon, lat in coordinates]) / len(coordinates),
                                  sum([lon for lon, lat in coordinates]) / len(coordinates)],
                         zoom_start=14)

# Prepare heatmap data (just coordinates, no specific count since it's not provided)
heat_data = [[lat, lon] for lon, lat in coordinates]

# Add the heatmap layer to the map
HeatMap(heat_data).add_to(map_heatmap)

# Add decibel markers to the map
def get_color(decibel):
    if decibel < 60:
        return 'green'
    elif 60 <= decibel < 65:
        return 'orange'
    else:
        return 'red'

for decibel, lon, lat in decibel_data:
    color = get_color(decibel)
    folium.Marker(
        location=[lat, lon],
        popup=f"<b>Decibel:</b> {decibel} dB<br>{lat}, {lon}",
        icon=folium.Icon(color=color, icon='volume-up', prefix='fa')
    ).add_to(map_heatmap)

# Add a custom legend to the map
legend_html_decibels = """
<div style="position: fixed; 
            bottom: 30px; left: 30px; width: 250px; height: 120px; 
            background-color: white; border:2px solid grey; z-index:9999;
            font-size: 16px; font-family: 'Helvetica', sans-serif; padding: 10px;">
    <b>Decibel Legend</b><br>
    <i style="background-color:green; width: 18px; height: 18px; float: left; margin-right: 10px;"></i> Low (below 60 dB)<br>
    <i style="background-color:orange; width: 18px; height: 18px; float: left; margin-right: 10px;"></i> Medium (60 - 64 dB)<br>
    <i style="background-color:red; width: 18px; height: 18px; float: left; margin-right: 10px;"></i> High (65+ dB)<br>
</div>
"""

# Add the legend to the map
map_heatmap.get_root().html.add_child(folium.Element(legend_html_decibels))

# Save the map with both heatmap and decibel markers to an HTML file
map_heatmap.save('heatmap_with_decibels.html')

# Print confirmation
print("Map has been saved as 'heatmap_with_decibels.html'.")
